
<script>
if (sessionStorage.getItem("loggedIn") !== "true") {
    window.location.replace("index.html");  // ‚ùå Agar login nahi hua, redirect
}
</script>


<button onclick="logout()">LogOut</button> 
<script>
function logout() {
    sessionStorage.removeItem("loggedIn");  // Login flag remove
    window.location.href = "index.html";     // Login page pe redirect
}
</script>



<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced Topic Manager ‚Äì Visual Tree</title>
<style>
body {
 
  
  font-family: Arial, sans-serif;
  background: #1b1b2f;
  color: #fff;
  padding: 20px;
  margin:0;
}
h2 { text-align:center; margin-bottom:10px; }
#controls { margin-bottom: 15px; display:flex; flex-wrap:wrap; gap:10px; align-items:center; }

/* Search bar */
#searchBox {
  padding:7px 12px;
  border-radius:20px;
  border:none;
  background: rgba(255,255,255,0.15);
  color:#fff;
  width:220px;
  transition: all 0.3s;
}
#searchBox::placeholder { color: #ddd; }

/* Buttons styling */
button {
  padding:5px 12px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:bold;
  color:#fff;
  background: linear-gradient(45deg,#6a11cb,#2575fc);
  transition: all 0.3s;
}
button:hover { opacity:0.85; }

/* Topic boxes */
.topic, .subtopic {
  padding: 10px 12px;
  border-radius: 10px;
  margin: 5px 0;
  position: relative;
  cursor: grab;
  user-select: none;
  display: flex;
  align-items: center;
  transition: all 0.3s;
  border-left: 3px solid #fff; /* Connector line left */
}

.subtopics { margin-left: 40px; border-left: 1px dashed #888; padding-left: 15px; }

.editable {
  border: none;
  background: transparent;
  color: #fff;
  font-weight: bold;
  font-size: 16px;
  flex: 1;
}

/* Popup & Overlay */
.popup, .overlay { display:none; }

.popup {
  position: fixed;
  background: rgba(40,40,60,0.95);
  top:0; left:0;
  width:100%; height:100%;
  z-index:100;
  overflow-y:auto;
  padding: 20px;
  box-sizing: border-box;
}

#descInput {
  width: 90%;
  min-height: 50%;
  font-size: 1.1em;
  line-height:1.5em;
  padding:10px;
  border-radius:8px;
  background: rgba(255,255,255,0.1);
  color:#fff;
  border:none;
  resize: vertical;
}

.overlay {
  position: fixed;
  top:0; left:0;
  width:100%; height:100%;
  background: rgba(0,0,0,0.7);
  z-index:99;
}

/* Collapse button */
.collapse-btn {
  font-size:12px;
  background: rgba(255,255,255,0.2);
  padding:2px 5px;
  border-radius:5px;
  margin-left:5px;
}

/* Icon */
.icon { margin-right:8px; font-size:16px; }

/* Hover highlight */
.topic:hover, .subtopic:hover { box-shadow:0 0 12px rgba(255,255,255,0.3); }

/* Level-based background colors */
.level-0 { background: linear-gradient(90deg,#ff7e5f,#feb47b);}
.level-1 { background: linear-gradient(90deg,#6a11cb,#2575fc);}
.level-2 { background: linear-gradient(90deg,#00f260,#0575e6);}
.level-3 { background: linear-gradient(90deg,#ff6a00,#ee0979);}
</style>
</head>
<body>

<h2>Advanced Topic Manager ‚Äì Visual Tree</h2>

<div id="controls">
  <input type="text" id="searchBox" placeholder="Search topics..." oninput="filterTopics()">
  <button onclick="addTopic()">Add Main Topic</button>
  <button onclick="deleteAllTopics()">Delete All</button>
  <button onclick="downloadJSON()">Download JSON</button>
  <input type="file" id="jsonFileInput" style="display:none" onchange="importFromFile(event)">
  <button onclick="document.getElementById('jsonFileInput').click()">Import JSON</button>
</div>

<div id="topicsContainer"></div>

<div class="overlay" id="overlay"></div>
<div class="popup" id="popup">
  <h3>Description</h3>
  <textarea id="descInput"></textarea><br><br>
  <button onclick="saveDesc()">Save</button>
  <button onclick="closePopup()">Cancel</button>
</div>

<script>
let topicsContainer = document.getElementById('topicsContainer');
let currentDescTarget = null;
const DELETE_PASSWORD = "Delete123"; 

let mainCounter = 0;
let subCounters = {};

// Load saved topics
window.onload = function(){
  let saved = localStorage.getItem("topicsData");
  if(saved){ importFromJSON(saved); }
};

// Save topics
function saveToLocal(){
  let data = [];
  function parseDiv(div){
    let obj = {
      id: div.getAttribute('data-id'),
      title: div.querySelector('.editable').value,
      desc: div.getAttribute('data-desc') || '',
      color: div.style.background,
      children: []
    };
    let subDivs = div.querySelectorAll(':scope > .subtopics > div');
    subDivs.forEach(sd=>obj.children.push(parseDiv(sd)));
    return obj;
  }
  topicsContainer.querySelectorAll(':scope > .topic').forEach(td=>data.push(parseDiv(td)));
  localStorage.setItem("topicsData", JSON.stringify(data));
}

// Drag & Drop
let dragged = null;
document.addEventListener('dragstart', function(e){ if(e.target.classList.contains('topic')||e.target.classList.contains('subtopic')) dragged=e.target; });
document.addEventListener('dragover', function(e){ if(dragged) e.preventDefault(); });
document.addEventListener('drop', function(e){
  if(dragged){
    let dropTarget = e.target.closest('.topic,.subtopic');
    if(dropTarget && dropTarget!==dragged && dropTarget.parentElement){ dropTarget.parentElement.insertBefore(dragged,dropTarget.nextSibling); saveToLocal(); }
  }
});

// Short ID generation
function generateShortID(parentID=null){
  if(!parentID){ let id=String.fromCharCode(65+mainCounter); mainCounter++; subCounters[id]=0; return id; }
  else{ let count=subCounters[parentID]||0; subCounters[parentID]=count+1; return parentID+(count+1); }
}

// Create topic
function addTopic(){ let div=createTopicDiv('New Main Topic',0,null); topicsContainer.appendChild(div); saveToLocal(); }
function createTopicDiv(title,level,parentID){
  let div = document.createElement('div');
  div.className='topic level-'+level;
  div.draggable=true;
  let id=parentID?generateShortID(parentID):generateShortID();
  div.setAttribute('data-id',id);
  div.innerHTML=`
    <span class="icon">üìå</span>
    <input class="editable" value="${title}" oninput="updateIcon(this)">
    <button onclick="editDesc(this)">Description</button>
    <button onclick="addSubtopic(this)">Add Subtopic</button>
    <button onclick="deleteTopic(this)">Delete</button>
    <input type="color" class="color-picker" onchange="changeColor(this)">
    <span class="collapse-btn" onclick="toggleCollapse(this)">Collapse</span>
    <button onclick="openNewPage(this)">Open Page</button>
    <span style="font-size:10px; margin-left:5px; color:#ccc;" class="topic-id-display">${id}</span>
    <div class="subtopics"></div>
  `;
  return div;
}

// Add subtopic
function addSubtopic(btn){ let parentDiv=btn.parentElement; let parentID=parentDiv.getAttribute('data-id'); let level=Number(parentDiv.className.match(/level-(\d+)/)[1])+1; let subDiv=createTopicDiv('New Subtopic',level,parentID); subDiv.className='subtopic level-'+level; parentDiv.querySelector('.subtopics').appendChild(subDiv); saveToLocal(); }

// Delete topic
function deleteTopic(btn){ let pass=prompt("Enter Delete Password:"); if(pass===DELETE_PASSWORD){ btn.parentElement.remove(); saveToLocal(); }else{ alert("Incorrect Password!"); } }
function deleteAllTopics(){ let pass=prompt("Enter Delete Password for All:"); if(pass===DELETE_PASSWORD){ topicsContainer.innerHTML=''; mainCounter=0; subCounters={}; saveToLocal(); } else{ alert("Incorrect Password!"); } }

// Description popup
function editDesc(btn){ currentDescTarget=btn.parentElement; let ta=document.getElementById('descInput'); ta.value=currentDescTarget.getAttribute('data-desc')||''; ta.style.fontSize='1.1em'; document.getElementById('overlay').style.display='block'; document.getElementById('popup').style.display='block'; }
function saveDesc(){ if(currentDescTarget){ currentDescTarget.setAttribute('data-desc',document.getElementById('descInput').value); saveToLocal(); } closePopup(); }
function closePopup(){ document.getElementById('overlay').style.display='none'; document.getElementById('popup').style.display='none'; currentDescTarget=null; }

// Color & collapse
function changeColor(input){ input.parentElement.style.background=input.value; saveToLocal(); }
function toggleCollapse(span){ let subDiv=span.parentElement.querySelector('.subtopics'); if(subDiv.style.display==='none'){ subDiv.style.display='block'; span.innerText='Collapse'; } else{ subDiv.style.display='none'; span.innerText='Expand'; } saveToLocal(); }

// Icon & filter
function updateIcon(input){ input.parentElement.querySelector('.icon').innerText='üìå'; saveToLocal(); }
function filterTopics(){ let kw=document.getElementById('searchBox').value.toLowerCase(); function filterDiv(d){ let title=d.querySelector('.editable').value.toLowerCase(); let match=title.includes(kw); let subDivs=d.querySelectorAll(':scope>.subtopics>div'); let any=false; subDivs.forEach(sd=>{ if(filterDiv(sd)) any=true; }); d.style.display=(match||any)?'flex':'none'; return match||any; } topicsContainer.querySelectorAll(':scope>.topic').forEach(td=>filterDiv(td)); }

// JSON
function downloadJSON(){ saveToLocal(); let data=localStorage.getItem("topicsData"); let blob=new Blob([data],{type:"application/json"}); let url=URL.createObjectURL(blob); let a=document.createElement('a'); a.href=url; a.download="topics.json"; a.click(); URL.revokeObjectURL(url); }
function importFromFile(event){ const file=event.target.files[0]; if(!file)return; const reader=new FileReader(); reader.onload=function(e){ importFromJSON(e.target.result); }; reader.readAsText(file); }
function importFromJSON(jsonStr){ try{ let data=JSON.parse(jsonStr); topicsContainer.innerHTML=''; mainCounter=0; subCounters={}; function buildDiv(obj,level){ let div=createTopicDiv(obj.title,level,null); div.className=(level===0)?'topic level-0':'subtopic level-'+level; div.style.background=obj.color||'#333'; div.setAttribute('data-desc',obj.desc||''); div.setAttribute('data-id',obj.id); obj.children.forEach(ch=>{ let sub=buildDiv(ch,level+1); div.querySelector('.subtopics').appendChild(sub); }); return div; } data.forEach(d=>{ let div=buildDiv(d,0); topicsContainer.appendChild(div); }); saveToLocal(); }catch(e){ alert('Invalid JSON'); } }

// Open new page
function openNewPage(btn){ let topicDiv=btn.parentElement; let topicID=topicDiv.getAttribute('data-id'); window.open("newpage.html?id="+encodeURIComponent(topicID),"_blank"); }
</script>
</body>
</html>
<button onclick="logout()">LogOut</button>

<script>
function logout() {
    sessionStorage.removeItem("loggedIn");  // Login flag remove
    window.location.href = "index.html";     // Login page pe redirect
}
</script>